"use strict";var ruta_generica="http://www.metropoligolfcenter.com/api/";function iniciarPartida(){var a=$("#codigo").val();localStorage.setItem("codigo",a),""==a?$("#alerta").html("<i class=\"fa fa-warning fa-lg\"></i>&nbsp;Debes ingresar un c\xF3digo").show():$("#avisoprivacidad").prop("checked")?$.ajax({url:ruta_generica+"obtener_partida",type:"POST",dataType:"JSON",data:{folio:a},success:function success(b){console.log(b),b.error?$("#alerta").html("<i class=\"fa fa-warning fa-lg\"></i>&nbsp; Ingresa un c\xF3digo valido").show():b.partida.id&&(localStorage.setItem("partida",JSON.stringify(b.partida)),localStorage.setItem("jugadores",JSON.stringify(b.jugadores)),localStorage.removeItem("clientes"),localStorage.setItem("clientes",JSON.stringify(b.jugadores)),location.href=2==b.partida.estado&&null!=b.jugadores?"scoreCard.html":"registroJugador.html")},error:function error(b,d,e){console.log("Function: iniciarPartida()"),console.log("Status: "+d),console.log("Error: "+e)}}):$("#alerta").html("<i class=\"fa fa-warning fa-lg\"></i>&nbsp;Debes aceptar el aviso de privacidad").show()}function continuar(){location.href="resultado2.html"}function ayuda(){localStorage.posicion=localStorage.actual,location.href="ayuda.html"}function atras(){var a=localStorage.posicion;1==a?location.href="index.html":2==a?location.href="registroJugador.html":3==a?location.href="scoreCard.html":4==a?location.href="resultado.html":5==a&&(location.href="resultado2.html")}function link(a){cordova.InAppBrowser.open(a)}function crearRegistro(){for(var a=JSON.parse(localStorage.getItem("clientes")),b=JSON.parse(localStorage.getItem("partida")),d="",e=0,g=1;e<b.numeroPersonas;e++,g++)d+=null===a?"<div class=\"col-12 mt-4\"><img class=\"img-responsive margin_jugador\" src=\"img/icono_registro_jugador.png\" alt=\"icono_jugador\" width=\"35px\"><label class=\"col-12 texto enlinea \">Jugador "+g+"</label><div class=\"row justify-content-around mt-2\"><input id=\"nombre"+g+"\" name=\"nombre"+g+"\" class=\"form-control\" type=\"text\" placeholder=\"Nombre\" maxlength=\"100\" onkeyup=\"crear_nickname("+g+")\"></div><div class=\"row justify-content-around mt-2\"><input id=\"apellido_paterno"+g+"\" name=\"apellido_paterno"+g+"\" class=\"form-control col-6\" type=\"text\" placeholder=\"Paterno\" maxlength=\"100\" onkeyup=\"crear_nickname("+g+")\"><input id=\"apellido_materno"+g+"\" name=\"apellido_materno"+g+"\" class=\"form-control col-6\" type=\"text\" placeholder=\"Materno\" maxlength=\"100\"></div><div class=\"row justify-content-around mt-2\"><input id=\"nickname"+g+"\" name=\"nickname"+g+"\" class=\"form-control col-4\" type=\"text\" placeholder=\"Nick\" maxlength=\"3\" /><input id=\"correo"+g+"\" name=\"correo"+g+"\" class=\"form-control col-8\" type=\"email\" placeholder=\"Correo\" maxlength=\"100\" /></div></div>":"<div class=\"col-12 mt-4\"><img class=\"img-responsive margin_jugador\" src=\"img/icono_registro_jugador.png\" alt=\"icono_jugador\" width=\"35px\"><label class=\"col-12 texto enlinea \">Jugador "+g+"</label><div class=\"row justify-content-around mt-2\"><input id=\"nombre"+g+"\" name=\"nombre"+g+"\" class=\"form-control\" type=\"text\" placeholder=\"Nombre\" value=\""+a[e].nombre+"\" maxlength=\"100\" readonly=\"readonly\" /></div><div class=\"row justify-content-around mt-2\"><input id=\"apellido_paterno"+g+"\" name=\"apellido_paterno"+g+"\" class=\"form-control col-6\" type=\"text\" placeholder=\"Paterno\" value=\""+a[e].apellido_paterno+"\" maxlength=\"100\" readonly=\"readonly\" /><input id=\"apellido_materno"+g+"\" name=\"apellido_materno"+g+"\" class=\"form-control col-6\" type=\"text\" placeholder=\"Materno\" value=\""+a[e].apellido_materno+"\" maxlength=\"100\" readonly=\"readonly\" /></div><div class=\"row justify-content-around mt-2\"><input id=\"nickname"+g+"\" name=\"nickname"+g+"\" class=\"form-control col-4\" type=\"text\" placeholder=\"Nick\" value=\""+a[e].nickname+"\" maxlength=\"4\" readonly=\"readonly\" /><input id=\"correo"+g+"\" name=\"correo"+g+"\" class=\"form-control col-8\" type=\"email\" placeholder=\"Correo\" value=\""+a[e].correo+"\" maxlength=\"100\" readonly=\"readonly\" /></div></div>";$("#jugadores").html(d)}function crear_nickname(a){""!==$("#nombre"+a).val()&&1<$("#apellido_paterno"+a).val().length&&""===$("#nickname"+a).val()&&$("#nickname"+a).val($("#nombre"+a).val().substr(0,1)+$("#apellido_paterno"+a).val().substr(0,2))}function iniciarJuego(){$("#alerta").hide();for(var a=JSON.parse(localStorage.getItem("partida")),b=JSON.parse(localStorage.getItem("clientes")),d=[],e=!1,g=1;g<parseInt(a.numeroPersonas)+1;g++){var h=$("#nombre"+g).val(),j=$("#apellido_paterno"+g).val(),k=$("#apellido_materno"+g).val(),l=$("#correo"+g).val(),m=$("#nickname"+g).val();(""==h||""==j||""==m)&&($("#alerta").html("<i class=\"fa fa-warning fa-lg\"></i>&nbsp; Campos vac\xEDos").show(),e=!0),d[g-1]={nombre:h,apellido_paterno:j,apellido_materno:k,correo:l,nickname:m}}var n=$("input[id*='correo']"),o=0;n.each(function(p,q){this.value&&(o++,$(q).removeAttr("disabled"))}),1<=o?n.each(function(){if(this.value){var r=/^[-\w.%+]{1,64}@(?:[A-Z0-9-]{1,63}\.){1,125}[A-Z]{2,63}$/i;r.test(this.value)?l=!0:($("#alerta").html("<i class=\"fa fa-warning fa-lg\"></i>&nbsp; Correo Invalido").show(),l=!1)}}):(l=!1,$("#alerta").html("<i class=\"fa fa-warning fa-lg\"></i>&nbsp; Correo Invalido o Vac\xEDo").show()),!1==e&&!0==l&&(o==n.length?$.ajax({url:ruta_generica+"guardar_jugadores",type:"POST",dataType:"JSON",data:{folio:localStorage.getItem("codigo"),jugadores:d},success:function success(p){localStorage.setItem("jugadores",JSON.stringify(p)),localStorage.setItem("clientes",JSON.stringify(d)),swal({title:"Espere un momento...",text:"Guardando jugadores",timer:2e3,onOpen:function onOpen(){swal.showLoading()}}).then(function(){location.href="scoreCard.html"})},error:function error(p,q,r){console.log("Function: iniciarJuego()"),console.log("Status: "+q),console.log("Error: "+r)}}):swal({title:"\xBFDeseas continuar?",text:"Tienes correos sin registrar",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si",cancelButtonText:"No"}).then(function(p){p.value&&$.ajax({url:ruta_generica+"guardar_jugadores",type:"POST",dataType:"JSON",data:{folio:localStorage.getItem("codigo"),jugadores:d},success:function success(q){localStorage.setItem("jugadores",JSON.stringify(q)),localStorage.setItem("clientes",JSON.stringify(d)),swal({title:"Espere un momento...",text:"Guardando jugadores",timer:2e3,onOpen:function onOpen(){swal.showLoading()}}).then(function(){location.href="scoreCard.html"})},error:function error(q,r,s){console.log("Function: iniciarJuego()"),console.log("Status: "+r),console.log("Error: "+s)}})}))}function finalizarPartidaForzada(){swal({title:"\xBFEstas seguro?",text:"Tu partida finalizara y ya no podras modificar tus resultados",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si",cancelButtonText:"No"}).then(function(a){if(a.value){var b=JSON.parse(localStorage.getItem("partida")),d="";d=1==b.mode?9:18;for(var e=1;e<=d;e++){var g=$(".hoyo"+e);g.each(function(j,k){if(!this.value){var l=$(k).attr("onchange");l=l.slice(0,-1),l+=", 1)",$(k).attr("onchange",l),$(k).trigger("onchange")}})}finalizarPartida()}})}function disabledInput(){var a=JSON.parse(localStorage.getItem("scorecard"));$(".input_tamano").attr("disabled","disabled");var b=JSON.parse(localStorage.getItem("partida")),d="";d=1==b.mode?9:18;for(var e=1;e<=d;e++){var g=$(".hoyo"+e),h=0;if(g.each(function(k,l){this.value&&(h++,$(l).removeAttr("disabled"))}),h==g.length){var j=e+1;$(".hoyo"+j).each(function(k,l){$(l).removeAttr("disabled")})}else break}0==a.length&&$(".hoyo1").removeAttr("disabled")}function finalizarPartida(){var a=JSON.parse(localStorage.getItem("partida"));a.estado=3;var b=JSON.parse(localStorage.getItem("jugadores")),d=!1,e="";e=1==a.mode?9:18;for(var g=1;g<=e;g++)for(var h=0;h<b.length;h++)(""==$("#"+b[h].id+g).val()||0!=$("#"+b[h].id+g).val()%1)&&(d=!0);if(!1==d){var j=localStorage.getItem("codigo");$.ajax({url:ruta_generica+"finalizar_partida",type:"POST",dataType:"JSON",data:{folio:j},success:function success(k){localStorage.setItem("puntajeGanadores",JSON.stringify(k)),swal({title:"Partida finalizada",text:"Guardando datos",timer:2e3,onOpen:function onOpen(){swal.showLoading()}}).then(function(){location.href="resultado.html"})},error:function error(k,l,m){console.log("Function: finalizarPartida()"),console.log("Status: "+l),console.log("Error: "+m)}})}else $("#alerta-message").html("<i class=\"fa fa-warning fa-lg\"></i>&nbsp; Debes ingresar el total de tiros de todos los hoyos y solo n\xFAmeros enteros"),$("#alerta").show()}function dibujarScoreCard(){var a=JSON.parse(localStorage.getItem("jugadores")),b=JSON.parse(localStorage.getItem("scorecard")),d=JSON.parse(localStorage.getItem("partida")),e="",g="",h="",j="",k="",l="",m="",n=0,o=a.length;3==d.estado&&(l=" readonly=\"readonly\" "),m=1==d.mode?9:18,k+=1==o?"35":2==o?"25":3==o?"18":4==o?"18":"14";for(var p=0;p<o;p++)g+="<td id=\"total_"+a[p].id+"\"></td>",h+="<td>"+a[p].nickname+"</td>",j+="<td><div class=\"circulo_jugador\"><div class=\"texto_chico\" >"+parseInt(p+1)+"</div></div></td>";$("#total").append(g).show(),$("#numeroJugadores").append(j).show(),$("#nombreJugadores").append(h).show();for(var q=1;q<=m;q++){e+="<tr>",e+="<td class=\"hoyo_par\"><div>"+q+"</div></td>",1==d.mode?(e+=2==q||4==q||9==q?"<td class=\"hoyo_par\"><div>3</div></td>":"<td class=\"hoyo_par\"><div>2</div></td>",n+=3):(e+=2==q||4==q||9==q||11==q||13==q||18==q?"<td class=\"hoyo_par\"><div>3</div></td>":"<td class=\"hoyo_par\"><div>2</div></td>",n+=2),e+="<td class=\"invisible\"></td>";for(var p=0;p<o;p++)e+=""!=b&&b[q]?b[q][a[p].id]?"<td style=\"width: "+k+"%;\"><input "+l+" data-log=\""+b[q][a[p].id].idLog+"\" id=\""+a[p].id+q+"\" name=\""+a[p].id+q+"\" class=\"input_tamano hoyo"+q+"\" type=\"number\" value=\""+b[q][a[p].id].puntos+"\" maxlength=\"1\" min=\"1\" max=\"9\" onchange=\"modificarScoreCard("+jQuery.trim(a[p].id)+", "+q+")\"></td>":"<td style=\"width: "+k+"%;\"><input data-log=\"0\" id=\""+a[p].id+q+"\" name=\""+a[p].id+q+"\" class=\"input_tamano hoyo"+q+"\" type=\"number\" value=\"\" maxlength=\"1\" min=\"1\" max=\"9\" onchange=\"modificarScoreCard("+jQuery.trim(a[p].id)+", "+q+")\"></td>":"<td style=\"width: "+k+"%;\"><input data-log=\"0\" id=\""+a[p].id+q+"\" name=\""+a[p].id+q+"\" class=\"input_tamano hoyo"+q+"\" type=\"number\" value=\"\" maxlength=\"1\" min=\"1\" max=\"9\" onchange=\"modificarScoreCard("+jQuery.trim(a[p].id)+", "+q+")\"></td>";e+="</tr>"}$("#totalTiros").html(n),$("#cuerpo").html(e).show();for(var g,p=0;p<o;p++){g=0;for(var r=1;r<=m;r++)""==!$("#"+a[p].id+r).val()&&(g+=parseInt($("#"+a[p].id+r).val()));$("#total_"+a[p].id).html(g).show()}}function peticionScoreCard(){$.ajax({url:ruta_generica+"obtener_partida",type:"POST",dataType:"JSON",data:{folio:localStorage.getItem("codigo")},success:function success(a){localStorage.removeItem("scorecard"),localStorage.setItem("scorecard",JSON.stringify(a.scorecard)),localStorage.removeItem("partida"),localStorage.setItem("partida",JSON.stringify(a.partida)),dibujarScoreCard()},error:function error(a,b,d){console.log("XMLHttpRequest: "+a),console.log("textStatus: "+b),console.log("errorThrown: "+d)}})}function modificarScoreCard(a,b){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0;$("#alerta").hide();var d=$("#"+a+b).val().toString().charAt(0),e=JSON.parse(localStorage.getItem("partida"));h?d=0:(0!=d%1||1>d||""==d)&&(d=1);var g={id:$("#"+a+b).attr("data-log").toString(),idCliente:a.toString(),idPartida:e.id.toString(),hoyo:b.toString(),cantidadTiros:d};$("#"+a+b).val(d),$.ajax({url:ruta_generica+"guardar_log",type:"POST",data:{log:g},success:function success(j){$("#"+a+b).attr("data-log",JSON.parse(j).idLog);var k=0,l="";l=1==e.mode?9:18;for(var m=1;m<=l;m++)""==!$("#"+a+m).val()&&(k+=parseInt($("#"+a+m).val()));$("#total_"+a).html(k)},error:function error(j,k,l){console.log("Function: modificarScoreCard()"),console.log("Status: "+k),console.log("Error: "+l)}})}function obtenerTop(){$.ajax({url:ruta_generica+"mejores_jugadores",type:"POST",dataType:"JSON",data:{},success:function success(a){localStorage.setItem("topGanadores",JSON.stringify(a));for(var b="",d=["Semanal","Mensual","Anual"],e=JSON.parse(localStorage.getItem("topGanadores")),g=0;3>g;g++)null!=e[g]&&(b+="<tr><td class=\"td_\">"+d[g]+"</td><td class=\"td_\">"+e[g].nombre+"</td><td class=\"td_\">"+e[g].puntos+"</td></tr>");$("#topGanadores").html(b)},error:function error(a,b,d){console.log("Function: obtenerTop()"),console.log("Status: "+b),console.log("Error: "+d)}})}function obtenerTopJugadores(){for(var a="<label class=\"col-8 texto text-center mt-4 txt_2\">Jugadores</label><label class=\"col-4 texto text-center mt-4 txt_2\">Puntos</label>",b=JSON.parse(localStorage.getItem("jugadores")),d=JSON.parse(localStorage.getItem("puntajeGanadores")),e=0;e<b.length;e++)a+=3>e?"<div class=\"input-group input-group-sm mt-4\"><figure class=\"col-3\"><img class=\"img-responsive\" src=\"img/"+parseInt(e+1)+".png\" alt=\"lugar_"+parseInt(e)+1+"\" width=\"50px\"></figure><label class=\"col-6 texto text_start mt-4 txt_2\">"+d[e].nombre+"</label><label class=\"col-3 texto text-center mt-4 txt_"+parseInt(e+1)+"\">"+d[e].total+"</label></div>":"<div class=\"input-group input-group-sm mt-4\"><figure class=\"col-3\"></figure><label class=\"col-6 texto text_start mt-4 txt_2\">"+d[e].nombre+"</label><label class=\"col-3 texto text-center mt-4 txt_"+parseInt(e+1)+"\">"+d[e].total+"</label></div>";$("#ganadoresPartida").html(a);var g=$("#ganadoresPartida").width(),h=$("#ganadoresPartida").height()+(3>=b.length?31.5*b.length:20*b.length)+35;html2canvas(document.getElementById("ganadoresPartida"),{width:g,height:h}).then(function(j){var k=j.toDataURL("image/png");localStorage.setItem("imgData",k)})}function enviarComentarios(){var a=$("#comentario").val(),b=localStorage.getItem("codigo");""==a?location.href="index.html":$.ajax({url:ruta_generica+"guardar_comentario",type:"POST",dataType:"JSON",data:{folio:b,comentario:a},success:function success(){location.href="index.html"},error:function error(d,e,g){console.log("Function: "+JSON.stringify(d)),console.log("Status: "+e),console.log("Error: "+g)}})}